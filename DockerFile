FROM python:3.12-slim

RUN apt-get update -y && \
    apt-get install -y curl git && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*

RUN useradd --create-home appuser
USER appuser

RUN mkdir -p /home/appuser/app


WORKDIR /home/appuser/app/

# Install uv and ensure it's in PATH for subsequent RUN commands
RUN curl -LsSf https://astral.sh/uv/install.sh | sh
ENV PATH="/home/appuser/.local/bin:$PATH"

# Copy source files for building
COPY --chown=appuser:appuser . /home/appuser/app/

# Install dependencies - use shell to ensure PATH is loaded
RUN bash -c "source ~/.bashrc && uv pip install ."

ENTRYPOINT ["python", "/home/appuser/app/main.py"]